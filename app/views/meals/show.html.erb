<div class="meal-show-container">
<h2 class="meals-index-title">献立詳細</h2>

  <!-- 📸 写真（スライダー） -->
    <% if @meal.images.attached? %>
      <div class="meal-slider">
        <div class="meal-slider-track">
          <% @meal.images.each do |image| %>
            <div class="meal-slide">
              <%= image_tag image.variant(resize_to_limit: [800, 600]), class: "meal-slide-img" %>
            </div>
          <% end %>
        </div>

        <% if @meal.images.size > 1 %>
          <button type="button" class="meal-slider-nav prev">‹</button>
          <button type="button" class="meal-slider-nav next">›</button>
        <% end %>
      </div>
    <% else %>
      <div class="meal-no-img">画像なし</div>
    <% end %>

  <!-- 📅 日付 -->
  <div class="meal-show-date">
    <%= @meal.date.strftime("%Y年 %-m月%-d日（#{%w(日 月 火 水 木 金 土)[@meal.date.wday]}）") %>
  </div>

  <!-- 👤 投稿者 -->
  <div class="meal-show-user">
    <i class="fa-solid fa-user"></i>
    <%= @meal.user == current_user ? "あなた" : "#{@meal.user.name}" %>
  </div>

  <!-- 🍽 献立名 -->
  <div class="meal-title">
    <h2><%= @meal.title %></h2>
  </div>

    <!-- ⭐ 評価 -->
    <div id="average-rating-area">
      <%= render "meals/average_rating", average_rating: @average_rating %>
    </div>

  <!-- 📝 メモ -->
    <div class="meal-show-description">
      <h3>メモ・感想</h3>
      <div class="meal-text">
        <%= simple_format(@meal.description) %>
      </div>
    </div>

  <!-- ✏️ 編集 / ❌ 削除 -->
  <% if @meal.user == current_user %>
    <div class="meal-show-actions">
      <%= link_to "編集", edit_meal_path(@meal), class: "meal-edit-btn" %>
      <%= link_to "削除", meal_path(@meal),
          data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？\n削除したデータは戻せません。" },
          class: "meal-delete-btn" %>
    </div>
  <% end %>

  <!-- ======================
     ⭐ コメント / 評価入力フォーム
  ====================== -->
  <div class="meal-show-rating-box">
    <div class="meal-rating-title">
      ⭐ 献立の評価とコメント ⭐
    </div>

    <%= form_with(model: [@meal, @meal.comments.build], data: { turbo: "false" }, local: false) do |f| %>

      <!-- ⭐ 星評価 -->
      <div class="star-rating" id="star-rating">
        <% 5.times do |i| %>
          <span class="star" data-value="<%= i + 1 %>">★</span>
        <% end %>
      </div>

      <!-- 🟡 評価（実際に送信する値） -->
      <%= f.hidden_field :rating, id: "hidden-rating-field" %>

      <!-- 💬 コメント -->
      <%= f.text_area :content, placeholder: "コメントを入力（任意）", rows: 3, class: "meal-rating-comment" %>

      <!-- 🚀 投稿ボタン -->
      <%= f.submit "送信する", class: "meal-rating-submit" %>
    <% end %>
  </div>

  <!-- ======================
      📊 評価・コメント一覧
  ====================== -->
  <div class="meal-comment-list">
    <h3>📝 みんなの評価とコメント</h3>

    <% if @comments.present? %>
      <% @comments.each do |comment| %>
        <%= render "comments/comment", comment: comment %>
      <% end %>
    <% else %>
      <p class="no-comments">まだ評価・コメントがありません</p>
    <% end %>
  </div>

  <div class="back-btn">
    <%= link_to "＜ 戻る", meals_path %>
  </div>

</div>