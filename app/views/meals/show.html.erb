<div class="meal-show-container">
<h2 class="meals-index-title">献立詳細</h2>

  <!-- 📸 写真 -->
  <div class="meal-show-image">
    <% if @meal.images.attached? %>
      <%= image_tag @meal.images.first.variant(resize_to_limit: [800, 600]), class: "meal-show-img" %>
    <% else %>
      <div class="meal-no-img">画像なし</div>
    <% end %>
  </div>

  <!-- 📅 日付 -->
  <div class="meal-show-date">
    <%= @meal.date.strftime("%Y年 %-m月%-d日（#{%w(日 月 火 水 木 金 土)[@meal.date.wday]}）") %>
  </div>

  <!-- 🍽 献立名 -->
  <div class="meal-title">
    <h2><%= @meal.title %></h2>

    <!-- ⭐ 評価 -->
      <% if @average_rating > 0 %>
        <% full_stars = @average_rating.floor %>
        <% half_star = (@average_rating - full_stars) >= 0.5 %>

        <div class="average-rating">
          <% full_stars.times do %>
            <span class="active-star">★</span>
          <% end %>

          <% if half_star %>
            <span class="half-star">★</span>
          <% end %>

          <% (5 - full_stars - (half_star ? 1 : 0)).times do %>
            <span class="inactive-star">★</span>
          <% end %>

          <span class="rating-number"><%= @average_rating %> / 5</span>
        </div>
      <% else %>
        <div class="no-rating">まだ評価がありません</div>
      <% end %>
    </div>

  <!-- 📝 メモ -->
    <div class="meal-show-description">
      <h3>メモ・感想</h3>
      <div class="meal-text">
        <%= simple_format(@meal.description) %>
      </div>
  </div>

  <!-- ✏️ 編集 / ❌ 削除 -->
  <div class="meal-show-actions">
    <%= link_to "編集", edit_meal_path(@meal), class: "meal-edit-btn" %>
    <%= link_to "削除", meal_path(@meal),
        data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？\n削除したデータは戻せません。" },
        class: "meal-delete-btn" %>

  <!-- ======================
     ⭐ コメント / 評価入力フォーム
  ====================== -->
  <div class="meal-show-rating-box">
    <div class="meal-rating-title">
      ⭐ 献立の評価とコメント ⭐
    </div>

    <%= form_with(model: [@meal, @meal.comments.build], data: { turbo: false }) do |f| %>

      <!-- ⭐ 星評価 -->
      <div class="star-rating" id="star-rating">
        <% 5.times do |i| %>
          <span class="star" data-value="<%= i + 1 %>">★</span>
        <% end %>
      </div>

      <!-- 🟡 評価（実際に送信する値） -->
      <%= f.hidden_field :rating, id: "hidden-rating-field" %>

      <!-- 💬 コメント -->
      <%= f.text_area :content, placeholder: "コメントを入力（任意）", rows: 3, class: "meal-rating-comment" %>

      <!-- 🚀 投稿ボタン -->
      <%= f.submit "送信する", class: "meal-rating-submit" %>
    <% end %>
  </div>

    <%= javascript_import_module_tag "meal_rating" %>

  <!-- ======================
      📊 評価・コメント一覧
  ====================== -->
  <div class="meal-comment-list">
    <h3>📝 みんなの評価とコメント</h3>

    <% if @comments.present? %>
      <% @comments.each do |comment| %>
        <%= render "comments/comment", comment: comment %>
      <% end %>
    <% else %>
      <p class="no-comments">まだ評価・コメントがありません</p>
    <% end %>
  </div>

  <!-- 🔮 AI献立アシスタント（ビューのみ） -->
  <div class="meal-ai-box">
    <h3>✨ AI献立アシスタント</h3>
    <p>※この機能は準備中です。</p>

    <button class="ai-btn">🥗 栄養・カロリー目安を分析する</button>
    <button class="ai-btn pink">💡 次の献立アイデアを提案してもらう</button>
  </div>

  <div class="back-btn">
    <%= link_to "＜ 戻る", meals_path %>
  </div>

</div>