<div class="memo-container">
  <h2>📝 メモ</h2>

  <!-- ⭐カテゴリーボタン -->
  <div class="memo-buttons">
    <%= link_to "🛒 買い物", memos_path(category: "shopping"), 
        class: "memo-btn shopping #{'active' if params[:category] == 'shopping'}",
        data: { category: "shopping" } %>

    <%= link_to "💡 料理", memos_path(category: "idea"), 
        class: "memo-btn idea #{'active' if params[:category] == 'idea'}",
        data: { category: "idea" } %>

    <%= link_to "📒 メモ", memos_path(category: "note"), 
        class: "memo-btn note #{'active' if params[:category] == 'note'}",
        data: { category: "note" } %>
  </div>

  <!-- ✏️ 入力フォーム -->
  <div id="memo-form" class="memo-form hidden">
    <%= form_with model: @memo, url: memos_path, local: true do |f| %>
      <%= f.hidden_field :category, value: params[:category].presence || "note" %>
      <%= f.text_area :content, placeholder: "ここにメモを書いてください", rows: 4 %>
      <%= f.submit "保存する", class: "memo-submit-btn" %>
    <% end %>
  </div>

  <!-- 📌 メモ一覧表示 -->
  <% if @memos.present? %>
    <div class="memo-list">
      <% @memos.each do |memo| %>
        <div class="memo-item <%= 'pinned' if memo.pinned? %>">
          <!-- 📍 ピン（左） -->
          <% if user_signed_in? && memo.user == current_user %>
            <div class="memo-pin-area">
              <%= link_to(
                    memo.pinned? ? "📍" : "📌",
                    toggle_pin_memo_path(memo),
                    data: { turbo_method: :patch },
                    class: "memo-pin-btn #{'pinned' if memo.pinned?}",
                    title: memo.pinned? ? "ピン解除" : "ピン固定"
                  ) %>
            </div>
          <% end %>

          <!-- 💬 メモ内容＋タグ（中央） -->
          <div class="memo-content">
          <p class="memo-text"><%= memo.content %></p>

          <span class="memo-tag <%= memo.category %>">
            <% case memo.category %>
            <% when "shopping" %>
              🛒 買い物
            <% when "idea" %>
              💡 作りたい料理
            <% when "note" %>
              📒 メモ
            <% else %>
              📌 <%= memo.category %>
            <% end %>
          </span>
        </div>

        <!-- 🗑 削除（右） -->
        <% if user_signed_in? && memo.user == current_user %>
          <div class="memo-delete-area">
            <%= link_to "🗑️",
                        memo_path(memo, category: params[:category]),
                        data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" },
                        class: "memo-delete-btn",
                        title: "削除" %>
           </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="no-memo">まだメモがありません。</p>
  <% end %>
</div>