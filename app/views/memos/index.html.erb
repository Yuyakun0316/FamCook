<div class="memo-container">
  <h2>ğŸ“ ãƒ¡ãƒ¢</h2>

  <!-- â­ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒœã‚¿ãƒ³ -->
  <div class="memo-buttons">
    <%= link_to "ğŸ›’ è²·ã„ç‰©", memos_path(category: "shopping"), 
        class: "memo-btn shopping #{'active' if params[:category] == 'shopping'}",
        data: { category: "shopping" } %>

    <%= link_to "ğŸ’¡ æ–™ç†", memos_path(category: "idea"), 
        class: "memo-btn idea #{'active' if params[:category] == 'idea'}",
        data: { category: "idea" } %>

    <%= link_to "ğŸ“’ ãã®ä»–", memos_path(category: "note"), 
        class: "memo-btn note #{'active' if params[:category] == 'note'}",
        data: { category: "note" } %>
  </div>

  <!-- âœï¸ å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div id="memo-form" class="memo-form hidden">
    <%= form_with model: @memo, url: memos_path, local: true do |f| %>
      <%= f.hidden_field :category, value: params[:category].presence || "note" %>
      <%= f.text_area :content, placeholder: "ã“ã“ã«ãƒ¡ãƒ¢ã‚’æ›¸ã„ã¦ãã ã•ã„", rows: 4 %>
      <%= f.submit "ä¿å­˜ã™ã‚‹", class: "memo-submit-btn" %>
    <% end %>
  </div>

  <!-- ğŸ“Œ ãƒ¡ãƒ¢ä¸€è¦§è¡¨ç¤º -->
  <% if @memos.present? %>
    <div class="memo-list">
      <% @memos.each do |memo| %>
        <div class="memo-item <%= 'pinned' if memo.pinned? %>">
          <!-- ğŸ“ ãƒ”ãƒ³ï¼ˆå·¦ï¼‰ -->
          <% if user_signed_in? && memo.user == current_user %>
            <div class="memo-pin-area">
              <button
                class="memo-pin-btn <%= 'pinned' if memo.pinned? %>"
                data-memo-id="<%= memo.id %>"
                data-category="<%= params[:category] %>"
                title="<%= memo.pinned? ? 'ãƒ”ãƒ³è§£é™¤' : 'ãƒ”ãƒ³å›ºå®š' %>">
                <%= memo.pinned? ? "ğŸ“" : "ğŸ“Œ" %>
              </button>
            </div>
          <% end %>

          <!-- ğŸ’¬ ãƒ¡ãƒ¢å†…å®¹ï¼‹ã‚¿ã‚°ï¼ˆä¸­å¤®ï¼‰ -->
          <div class="memo-content <%= 'center-text' unless memo.user == current_user %>">
          <!-- ğŸ‘¤ æŠ•ç¨¿è€…è¡¨ç¤ºï¼†æ™‚é–“ -->
          <p class="memo-user-info">
            ğŸ‘¤ <%= memo.user.name.presence || memo.user.email %>
            <span class="memo-date">ï¼ˆ<%= time_ago(memo.created_at) %>ï¼‰</span>
          </p>
          
          <p class="memo-text"><%= memo.content %></p>

          <span class="memo-tag <%= memo.category %>">
            <% case memo.category %>
            <% when "shopping" %>
              ğŸ›’ è²·ã„ç‰©
            <% when "idea" %>
              ğŸ’¡ ä½œã‚ŠãŸã„æ–™ç†
            <% when "note" %>
              ğŸ“’ ãã®ä»–
            <% else %>
              ğŸ“Œ <%= memo.category %>
            <% end %>
          </span>
        </div>

        <!-- ğŸ—‘ å‰Šé™¤ï¼ˆå³ï¼‰ -->
        <% if user_signed_in? && memo.user == current_user %>
          <div class="memo-delete-area">
            <button
              type="button"
              class="memo-delete-btn"
              data-memo-id="<%= memo.id %>"
              data-category="<%= params[:category] %>"
              title="å‰Šé™¤">
              ğŸ—‘ï¸
            </button>
           </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="no-memo">ã¾ã ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  <% end %>
</div>